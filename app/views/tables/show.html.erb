<h2>みんなの点数</h2>

<%= link_to "評価の分布はこちら", distribution_graph_path, class:"btn btn-info margin-5px" %>

<h3>注意</h3>
<ul>
  <li>総合点数は各教科の点数から可の最低点を引いて積算しています。</li>
</ul>


<table class="table table-hover table-responsive table-striped table-bordered table-bordered-darkgray">
  <thead>
  <tr>
    <th>順位</th>
    <th>名前</th>
    <th>総合点数</th>
    <% @subjects.each do |subject| %>
      <th><%= subject.key %> </th>
    <% end %>
  </tr>
  </thead>

  <tbody>
  <% @user_scores.each_with_index do |user_score, idx| %>
    <% if user_score.user_id == current_user.id %>
      <tr class="bg-info">
    <% else %>
      <tr>
    <% end %>
      <th><%= idx + 1 %></th>
      
      <% if user_score.user.open_user_name %>
        <td><%= user_score.user.user_name %></td>
      <% else %>
        <td> - </td>
      <% end %>

      <% if user_score.user.open_score %>
        <td><%= user_score.total_score %></td>
      <% else %>
        <td> - </td>
      <% end %>

      <% if user_score.user.open_score %>
        <%# user_score.scores.each do |score| %>
        <% for subject_id in @subject_ids %>
          <%##### to find_out the score which has the certain subject_id #####%>
          <% this_score = "" %>
          <% user_score.scores.each do |score|%>
            <% if score.subject_id == subject_id %>
              <% this_score = score %>
              <% break %>
            <% end %>
          <% end %>
          <%# score = user_score.scores.find_by(subject_id: subject_id) %>
          <%##### finish #####%>
  
          <% if this_score.registered %>
            <td class="font-weight-bolder"><%= score_evaluate(this_score.value) %></td>
          <% else %>
            <td>未受講</td>
          <% end %>
        <% end %>
      <% else %>
        <% @subjects.size.times do %>
          <td> - </td>
        <% end %>
      <% end %>
    </tr>
  <% end %>
  </tbody>
  
</table>